<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chi ti·∫øt game</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="../Css/Game.css" />
  </head>

  <body>
    <nav class="navbar navbar-expand-lg custom-navbar">
      <div class="container-fluid">
        <!-- Logo -->
        <a
          class="navbar-brand d-flex align-items-center"
          href="../HTML/index.html"
        >
          <img src="../Img/Game_logo.webp" alt="Logo" />
          <span>Game downloader</span>
        </a>

        <!-- N√∫t hamburger -->
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#mainNavbar"
          aria-controls="mainNavbar"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Menu -->
        <div
          class="collapse navbar-collapse justify-content-end"
          id="mainNavbar"
        >
          <ul class="navbar-nav mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="btn btn-search-nav ms-2" href="./search.html"
                >üîç T√¨m ki·∫øm game</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./new_game.html">Game m·ªõi</a>
            </li>
            <li class="nav-item dropdown custom-dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="genreDropdown"
                role="button"
              >
                Th·ªÉ lo·∫°i
              </a>
              <ul
                class="dropdown-menu genre-menu"
                aria-labelledby="genreDropdown"
              >
                <li>
                  <a class="dropdown-item" href="./Game_hanh_dong.html"
                    >H√†nh ƒë·ªông</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="./Game_phieu_luu.html"
                    >Phi√™u l∆∞u</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="./Game_nhap_vai.html"
                    >Nh·∫≠p vai</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="./Game_kinh_di.html"
                    >Kinh d·ªã</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="./Game_the_thao.html"
                    >Th·ªÉ thao</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="./Game_mo_phong.html"
                    >M√¥ ph·ªèng</a
                  >
                </li>
              </ul>
            </li>

            <!-- Khi ch∆∞a ƒëƒÉng nh·∫≠p -->
            <li class="nav-item">
              <a class="nav-link" href="./login.html" id="loginBtn"
                >ƒêƒÉng nh·∫≠p</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./register.html" id="registerBtn"
                >ƒêƒÉng k√Ω</a
              >
            </li>

            <!-- Khi ƒë√£ ƒëƒÉng nh·∫≠p -->
            <li
              class="nav-item dropdown user-dropdown"
              id="userDropdown"
              style="display: none"
            >
              <a
                class="nav-link dropdown-toggle d-flex align-items-center"
                href="#"
                id="userDropdownBtn"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <img
                  id="userAvatar"
                  src="../Img/user.jpg"
                  alt="User"
                  class="user-avatar"
                />
                <span id="userNameLabel" style="margin-left: 8px"></span>
              </a>
              <ul
                class="dropdown-menu user-menu dropdown-menu-end"
                aria-labelledby="userDropdownBtn"
              >
                <li>
                  <span class="dropdown-item-text" id="userEmail"
                    >dochibinh1981@gmail.com</span
                  >
                </li>
                <li>
                  <span class="dropdown-item-text">
                    S·ªë d∆∞:
                    <span id="dropdownBalance" style="color: red">0 ƒë</span>
                  </span>
                </li>

                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="./profile.html">T√†i kho·∫£n</a>
                </li>
                <li>
                  <a class="dropdown-item" href="./deposit_money.html"
                    >N·∫°p ti·ªÅn</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="./leaderboard.html"
                    >Top n·∫°p ti·ªÅn</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="./purchased.html"
                    >Game ƒë√£ mua</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="#" id="logoutBtnDropdown"
                    >ƒêƒÉng xu·∫•t</a
                  >
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- MAIN -->
    <main class="main-section">
      <div class="container">
        <div class="khung">
          <div class="game-hero">
            <img id="d-img" alt="Game Image" />

            <div class="hero-info">
              <h1 id="d-title">ƒêang t·∫£i...</h1>

              <div class="meta-grid">
                <p><strong>Th·ªÉ lo·∫°i:</strong> <span id="d-genres"></span></p>
                <p>
                  <strong>Ng√†y ph√°t h√†nh:</strong> <span id="d-released"></span>
                </p>
                <p>
                  <strong>Nh√† ph√°t h√†nh:</strong>
                  <span id="d-publishers"></span>
                </p>
                <p><strong>C·∫≠p nh·∫≠t:</strong> <span id="d-updated"></span></p>
                <p>
                  <strong>Nh√† ph√°t tri·ªÉn:</strong>
                  <span id="d-developers"></span>
                </p>
                <p><strong>Rating:</strong> <span id="d-rating"></span></p>
              </div>
              <p class="ro"><strong>Tags:</strong> <span id="d-tags"></span></p>
            </div>
          </div>
        </div>

        <!-- M√î T·∫¢ -->
        <div class="khung2" style="margin-top: 30px">
          <h3 style="color: #03e0e0; margin-bottom: 15px">üìú M√¥ t·∫£ game</h3>

          <p id="d-desc" style="white-space: pre-line">ƒêang t·∫£i m√¥ t·∫£...</p>
          <button
            id="translate-btn"
            class="btn-download"
            style="max-width: 260px"
          >
            D·ªãch sang ti·∫øng Vi·ªát
          </button>
        </div>
      </div>

      <div class="khung2">
        <p class="ng">Y√™u c·∫ßu c·∫•u h√¨nh:</p>
        <p><span id="d-requirements"></span></p>
      </div>

      <section>
        <div class="carousel-container">
          <button class="nav prev" onclick="prevSlide()">‚Äπ</button>

          <div class="carousel-track" id="carousel-track"></div>

          <button class="nav next" onclick="nextSlide()">‚Ä∫</button>

          <div class="carousel-dots" id="carousel-dots"></div>
        </div>
      </section>

      <section class="feedback" id="danh-gia">
      <h2>ƒê√°nh gi√° ng∆∞·ªùi ch∆°i</h2>
      <div class="feedback-list">
        <div class="feedback-card">
          <img src="../Img/user.jpg" alt="Ng∆∞·ªùi d√πng" />
          <div>
            <strong>H√πng Tr·∫ßn</strong><br />
            ƒê·ªì h·ªça ƒë·ªânh th·∫≠t s·ª±, c·∫£m gi√°c nh∆∞ ƒëang xem phim ƒëi·ªán ·∫£nh. C∆° ch·∫ø
            chi·∫øn ƒë·∫•u kh√≥ nh∆∞ng ƒë√£!
          </div>
        </div>
      </div>

      <!-- Form b√¨nh lu·∫≠n -->
      <div class="comment-box">
        <h2>ƒê·ªÉ l·∫°i b√¨nh lu·∫≠n</h2>
        <form id="commentForm">
          <input type="text" id="userName" placeholder="T√™n c·ªßa b·∫°n" />
          <textarea
            id="userComment"
            placeholder="C·∫£m nghƒ© v·ªÅ game..."
          ></textarea>
          <button type="submit">G·ª≠i</button>
        </form>
      </div>
    </section>


    
    </main>

    <script>
      const API_KEY = "d63e85e85042401899d08350ad872094";
      const gameId = new URLSearchParams(window.location.search).get("id");

      let originalDesc = "";
      let translatedDesc = "";
      let isVietnamese = false;

      // =========================
      //     T·∫¢I GAME + ·∫¢NH
      // =========================
      async function loadGame() {
        if (!gameId) return;

        const url = `https://api.rawg.io/api/games/${gameId}?key=${API_KEY}`;
        const data = await fetch(url).then((res) => res.json());

        // -------- 1. ·∫¢NH CHO CAROUSEL --------
        const imgs = [];

        if (data.background_image) imgs.push(data.background_image);
        if (data.background_image_additional)
          imgs.push(data.background_image_additional);

        if (data.short_screenshots && data.short_screenshots.length > 0) {
          data.short_screenshots.forEach((s) => {
            if (s.image) imgs.push(s.image);
          });
        }

        window.gameImages = imgs;
        initCarousel();

        // -------- 2. ·∫¢NH HERO --------
        document.getElementById("d-img").src =
          data.background_image ||
          "https://png.pngtree.com/png-clipart/20190920/original/pngtree-blue-gamepad-illustration-png-image_4635515.jpg";

        // -------- 3. TH√îNG TIN GAME --------
        document.getElementById("d-title").textContent = data.name;
        document.getElementById("d-genres").textContent =
          (data.genres || []).map((g) => g.name).join(", ") || "Kh√¥ng c√≥";
        document.getElementById("d-released").textContent =
          data.released ?? "Kh√¥ng r√µ";
        document.getElementById("d-updated").textContent =
          data.updated?.slice(0, 10) ?? "Kh√¥ng r√µ";
        document.getElementById("d-publishers").textContent =
          (data.publishers || []).map((p) => p.name).join(", ") || "Kh√¥ng c√≥";
        document.getElementById("d-developers").textContent =
          (data.developers || []).map((d) => d.name).join(", ") || "Kh√¥ng c√≥";

        // -------- 4. M√î T·∫¢ --------
        originalDesc = data.description_raw || "Kh√¥ng c√≥ m√¥ t·∫£.";
        document.getElementById("d-desc").textContent = originalDesc;

        // -------- 5. Y√äU C·∫¶U PC --------
        const pc = (data.platforms || []).find(
          (p) => p.platform?.name === "PC"
        );
        const reqMin = pc?.requirements?.minimum || "";
const reqRec = pc?.requirements?.recommended || "";

const minList = cleanRequirements(reqMin)
  .map(item => `<li>${item}</li>`)
  .join("");

const recList = cleanRequirements(reqRec)
  .map(item => `<li>${item}</li>`)
  .join("");

document.getElementById("d-requirements").innerHTML = `
  <strong>T·ªëi thi·ªÉu:</strong>
  <ul>${minList}</ul>

  <strong>ƒê·ªÅ ngh·ªã:</strong>
  <ul>${recList}</ul>
`;


        // -------- 6. TAGS --------
        document.getElementById("d-tags").textContent =
          (data.tags || []).map((t) => t.name).join(", ") || "Kh√¥ng c√≥";

        document.getElementById("d-rating").textContent =
          data.rating ?? "Kh√¥ng c√≥";
      }
function cleanRequirements(text) {
  if (!text) return [];

  // X√≥a tag HTML
  text = text.replace(/<\/?[^>]+>/g, "");

  // Thay c√°c t·ª´ kh√≥a b·∫±ng xu·ªëng d√≤ng (t·ª± t√°ch)
  const keywords = [
    "OS:", "Processor:", "Memory:", "Graphics:", "Storage:",
    "Sound Card:", "Additional Notes:", "Network:", "DirectX:", "Other requirements:"
  ];

  keywords.forEach(key => {
    text = text.replaceAll(key, "\n" + key);
  });

  // T√°ch t·ª´ng d√≤ng
  return text
    .split("\n")
    .map(t => t.trim())
    .filter(t => t.length > 0);
}

      // =========================
      //   CAROUSEL CODE
      // =========================
      let current = 0;
      let images = [];
      let dots = [];

      function initCarousel() {
        const imagesArr = window.gameImages || [];
        const track = document.getElementById("carousel-track");
        const dotsContainer = document.getElementById("carousel-dots");

        track.innerHTML = "";
        dotsContainer.innerHTML = "";

        if (imagesArr.length === 0) {
          track.innerHTML = "<p style='color:white'>Kh√¥ng c√≥ ·∫£nh.</p>";
          return;
        }

        imagesArr.forEach((url, i) => {
          const img = document.createElement("img");
          img.src = url;
          img.className = "carousel-img" + (i === 0 ? " active" : "");
          track.appendChild(img);

          const dot = document.createElement("span");
          dot.className = "dot" + (i === 0 ? " active" : "");
          dot.onclick = () => goToSlide(i);
          dotsContainer.appendChild(dot);
        });

        images = document.querySelectorAll(".carousel-img");
        dots = document.querySelectorAll(".dot");

        updateCarousel();
      }

      function updateCarousel() {
        images.forEach((img, i) =>
          img.classList.toggle("active", i === current)
        );
        dots.forEach((dot, i) => dot.classList.toggle("active", i === current));
      }

      function nextSlide() {
        if (images.length === 0) return;
        current = (current + 1) % images.length;
        updateCarousel();
      }

      function prevSlide() {
        if (images.length === 0) return;
        current = (current - 1 + images.length) % images.length;
        updateCarousel();
      }

      function goToSlide(i) {
        current = i;
        updateCarousel();
      }

      setInterval(() => {
        if (images.length > 0) nextSlide();
      }, 3000);

      loadGame();
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const loginBtn = document.getElementById("loginBtn");
        const registerBtn = document.getElementById("registerBtn");
        const logoutBtn = document.getElementById("logoutBtn");
        const welcomeUser = document.getElementById("welcomeUser");

        const isLoggedIn = localStorage.getItem("loggedIn");
        const currentUser = localStorage.getItem("currentUser");
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const balance = localStorage.getItem("userBalance");
        const balanceEl = document.getElementById("dropdownBalance");
        if (balanceEl && balance !== null) {
          balanceEl.textContent = Number(balance).toLocaleString() + " ƒë";
        }
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const loginBtn = document.getElementById("loginBtn");
        const registerBtn = document.getElementById("registerBtn");
        const userDropdown = document.getElementById("userDropdown");
        const userNameLabel = document.getElementById("userNameLabel");
        const userEmailDisplay = document.getElementById("userEmail");
        const logoutBtnDropdown = document.getElementById("logoutBtnDropdown");

        const isLoggedIn = localStorage.getItem("loggedIn");
        const currentUser = localStorage.getItem("currentUser");
        const currentEmail = localStorage.getItem("currentEmail");

        if (isLoggedIn === "true" && currentUser) {
          if (loginBtn) loginBtn.style.display = "none";
          if (registerBtn) registerBtn.style.display = "none";
          if (userDropdown) userDropdown.style.display = "block";

          userNameLabel.textContent = currentUser;
          userEmailDisplay.textContent =
            currentEmail || "dochibinh1981@gmail.com";

          if (logoutBtnDropdown) {
            logoutBtnDropdown.addEventListener("click", function () {
              localStorage.removeItem("loggedIn");
              localStorage.removeItem("currentUser");
              localStorage.removeItem("currentEmail");
              location.reload();
            });
          }
        }
      });
    </script>
    <script>
      
    </script>
    <script>
      window.addEventListener("load", function () {
        const savedAvatar = localStorage.getItem("userAvatar");
        const avatarImg = document.getElementById("userAvatar");

        if (savedAvatar && avatarImg) {
          avatarImg.src = savedAvatar;
        }
      });
    </script>
    <!-- SCRIPT -->
    <script>
      async function translateGoogle(text) {
        try {
          const res = await fetch(
            "https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=vi&dt=t&q=" +
              encodeURIComponent(text)
          );
          const data = await res.json();
          return data[0].map((t) => t[0]).join("");
        } catch {
          return text;
        }
      }

      document.getElementById("translate-btn").onclick = async () => {
        const btn = document.getElementById("translate-btn");

        if (!isVietnamese) {
          // d·ªãch
          if (!translatedDesc) {
            btn.textContent = "ƒêang d·ªãch...";
            translatedDesc = await translateGoogle(originalDesc);
          }

          document.getElementById("d-desc").innerHTML = translatedDesc.replace(
            /\n/g,
            "<br/>"
          );
          btn.textContent = "Hi·ªÉn th·ªã ti·∫øng g·ªëc";
          isVietnamese = true;
        } else {
          // ti·∫øng g·ªëc
          document.getElementById("d-desc").innerHTML = originalDesc.replace(
            /\n/g,
            "<br/>"
          );
          btn.textContent = "D·ªãch sang ti·∫øng Vi·ªát";
          isVietnamese = false;
        }
      };
    </script>
  <button id="scrollToTop" title="L√™n ƒë·∫ßu trang">‚¨Ü</button>
  </body>
  <footer class="fancy-footer">
  <div class="footer-container">
    <div class="footer-section brand">
      <img src="../Img/Game_logo.webp" alt="Logo" />
      <h2>Game Downloader</h2>
      <p>T·∫£i game t·ªëc ƒë·ªô cao ‚Äì C·∫≠p nh·∫≠t game hot m·ªói ng√†y!</p>
    </div>

    <div class="footer-section links">
      <h3>Danh m·ª•c</h3>
      <ul>
        <li><a href="./index.html">Trang ch·ªß</a></li>
          <li><a href="./new_game.html">Game m·ªõi</a></li>
          <li><a href="./tintuc_1.html">Tin t·ª©c</a></li>
      </ul>
    </div>

    <div class="footer-section support">
      <h3>H·ªó tr·ª£</h3>
      <ul>
        <li><a href="#">Ch√≠nh s√°ch b·∫£o m·∫≠t</a></li>
        <li><a href="#">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a></li>
        <li><a href="#">Li√™n h·ªá</a></li>
        <li><a href="#">FAQs</a></li>
      </ul>
    </div>

    <div class="footer-section social">
      <h3>K·∫øt n·ªëi</h3>
      <div class="social-icons">
        <a href="#"><img src="../Img/Facebook.webp" alt="Facebook" /></a>
        <a href="#"><img src="../Img/YouTube.png" alt="YouTube" /></a>
        <a href="#"><img src="../Img/tiktok.jpg" alt="TikTok" /></a>
      </div>
    </div>
  </div>

  <div class="footer-bottom">
    <p>&copy; 2025 Game Downloader. All rights reserved.</p>
  </div>
</footer>

</html>
